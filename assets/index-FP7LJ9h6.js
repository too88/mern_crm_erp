import{au as A,r as n,j as e,an as W,aB as z,aC as H}from"./index-m26f_zdL.js";import{a as B,C as G,b as J,D as K,d as Q,S as X,u as Y,s as Z,e as ee,R as te,U as se,f as ae,g as re,T as P,h as R,c as ne,i as ce,j as le}from"./useOnFetch-MNTF9aOv.js";import{u as U,B as V,S as d,E as oe,r as $,C as ue,a as ie}from"./ErpApp-Ig8g1Q8H.js";import{R as q,C as I,E as de,I as D,S as he,F as me}from"./selector-J3-LdH-1.js";import{I as _}from"./index-tEiCAhz_.js";const xe=({config:t})=>e.jsx(q,{gutter:8,children:e.jsx(I,{className:"gutter-row",span:24,children:e.jsx(X,{config:t})})});function pe({config:t,formElements:u}){const c=U(),a=A(),{crudContextAction:r,state:j}=Y(),{deleteModalLabels:m}=t,{editBox:x,modal:p}=r,{isReadBoxOpen:b,isEditBoxOpen:f}=j,{result:s}=W(Z),[h,y]=n.useState(""),v=()=>{a(B.currentAction({actionType:"update",data:s})),x.open()},S=()=>{a(B.currentAction({actionType:"delete",data:s})),p.open()},L=b||f?{opacity:1}:{opacity:0};return n.useEffect(()=>{if(s){const C=m.map(O=>s[O]).join(" ");y(C)}},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(q,{style:L,gutter:24,children:[e.jsx(I,{span:10,children:e.jsx("p",{style:{marginBottom:"10px"},children:h})}),e.jsxs(I,{span:14,children:[e.jsx(V,{onClick:S,type:"text",icon:e.jsx(ee,{}),size:"small",style:{float:"right",marginLeft:"0px",marginTop:"10px"},children:c("remove")}),e.jsx(V,{onClick:v,type:"text",icon:e.jsx(de,{}),size:"small",style:{float:"right",marginRight:"5px",marginTop:"10px"},children:c("edit")})]}),e.jsx(I,{span:24,children:e.jsx("div",{className:"line"})}),e.jsx("div",{className:"space10"})]}),e.jsx(te,{config:t}),e.jsx(se,{config:t,formElements:u})]})}function we({config:t,createForm:u,updateForm:c}){const a=A();return n.useLayoutEffect(()=>{a(B.resetState())},[]),e.jsxs(G,{config:t,headerPanel:e.jsx(xe,{config:t}),sidePanelTopContent:e.jsx(pe,{config:t,formElements:c}),sidePanelBottomContent:e.jsx(J,{config:t,formElements:u}),children:[e.jsx(K,{config:t}),e.jsx(Q,{config:t})]})}function fe({entity:t,displayLabels:u,searchFields:c,outputValue:a="_id",value:r,onChange:j}){let{onFetch:m,result:x,isSuccess:p,isLoading:b}=ae();const[f,s]=n.useState([]),[h,y]=n.useState(void 0),v=n.useRef(!1),S=n.useRef(!1),[L,C]=n.useState(!1),[O,T]=n.useState(""),[w,o]=n.useState(""),[,i]=re(()=>{o(O)},z,[O]),g=async l=>await $.search({entity:t,options:l}),F=l=>u.map(E=>l[E]).join(" "),k=l=>{l&&l!=""&&(S.current=!0,C(!0),s([]),y(void 0),T(l))};return n.useEffect(()=>{if(w!=""){const E=g({q:w,fields:c});m(E)}return()=>{i()}},[w]),n.useEffect(()=>{S.current&&(p?s(x):(C(!1),y(void 0),s([])))},[p,x]),n.useEffect(()=>{r&&v.current&&(S.current?(y(r[a]||r),j(r[a]||r),v.current=!1):s([r]))},[r]),e.jsx(d,{loading:b,showSearch:!0,allowClear:!0,placeholder:"search",defaultActiveFirstOption:!1,filterOption:!1,notFoundContent:L?"... searching":e.jsx(oe,{}),value:h,onSearch:k,onChange:l=>{j&&l&&j(l[a]||l)},onClear:()=>{s([]),y(void 0),C(!1)},children:f.map(l=>e.jsx(d.Option,{value:l[a]||l,children:F(l)},l[a]||l))})}function je(t){const[u,c]=n.useState(null),[a,r]=n.useState(!0),[j,m]=n.useState(!1),[x,p]=n.useState(null);return n.useEffect(()=>{async function b(){try{const f=await t();c(f.result),m(!0)}catch(f){p(f)}finally{r(!1)}}b()},[a]),{data:u,isLoading:a,isSuccess:j,error:x}}function be(t){const{data:u,isLoading:c,isSuccess:a,error:r}=je(t);return{result:u,isLoading:c,isSuccess:a,error:r}}const ye=({entity:t,displayLabels:u=["name"],outputValue:c="_id",redirectLabel:a="",withRedirect:r=!1,urlRedirect:j="/",value:m,onChange:x})=>{var w;const[p,b]=n.useState([]),[f,s]=n.useState(void 0),h=H(),y=()=>$.list({entity:t}),{result:v,isLoading:S,isSuccess:L}=be(y),C=o=>{if(o==="redirectURL")h(j);else{const i=o[c]??o;s(o),x(i)}},O=o=>u.map(i=>o[i]).join(" "),T=()=>{const o=[];if(p.length===0&&r){const i="redirectURL",g=`+ ${a}`;o.push({value:i,label:g})}return p.map(i=>{var E;const g=i[c]??i,F=O(i),k=((E=i[c])==null?void 0:E.color)??(i==null?void 0:i.color),l=ne.find(M=>M.color===k);o.push({value:g,label:F,color:l==null?void 0:l.color})}),o};return n.useEffect(()=>{if(m){const o=m[c]??m;s(o),x(o)}},[m]),n.useEffect(()=>{L&&b(v)},[L]),e.jsx(d,{loading:S,disabled:S,value:f,onChange:C,children:(w=T())==null?void 0:w.map(o=>e.jsx(d.Option,{value:o.value,children:e.jsx(P,{bordered:!1,color:o.color,children:o.label})},`${R.generate()}`))})};function Ee({fields:t}){const[u,c]=n.useState();return e.jsx(e.Fragment,{children:Object.keys(t).map(a=>{let r=t[a];if(!r.disableForForm){if(r.name=a,r.label||(r.label=a),r.hasFeedback)return e.jsx(N,{setFeedback:c,field:r},a);if(u&&r.feedback){if(u==r.feedback)return e.jsx(N,{field:r},a)}else return e.jsx(N,{field:r},a)}})})}function N({field:t,setFeedback:u}){var x,p,b,f;const c=U(),a=ce(),r={string:e.jsx(D,{autoComplete:"off"}),url:e.jsx(D,{addonBefore:"https://",autoComplete:"off",placeholder:"www.sample.com"}),textarea:e.jsx(D.TextArea,{rows:4}),email:e.jsx(D,{autoComplete:"off",placeholder:"sample@gmail.com"}),phone:e.jsx(D,{style:{width:"100%"},placeholder:"+84 909 123 123"}),number:e.jsx(_,{style:{width:"100%"}}),boolean:e.jsx(he,{checkedChildren:e.jsx(ue,{}),unCheckedChildren:e.jsx(ie,{})}),async:e.jsx(ye,{entity:t.entity,displayLabels:t.displayLabels,outputValue:t.outputValue,loadDefault:t.loadDefault,withRedirect:t.withRedirect,urlRedirect:t.urlRedirect,redirectLabel:t.redirectLabel}),currency:e.jsx(_,{className:"moneyInput",min:0,controls:!1,addonAfter:a.currency_position==="after"?a.currency_symbol:void 0,addonBefore:a.currency_position==="before"?a.currency_symbol:void 0}),select:e.jsx(d,{defaultValue:t.defaultValue,style:{width:"100%"},children:(x=t.options)==null?void 0:x.map(s=>e.jsx(d.Option,{value:s.value,children:s.label},`${R.generate()}`))}),color:e.jsx(d,{defaultValue:t.defaultValue,style:{width:"100%"},children:(p=t.options)==null?void 0:p.map(s=>e.jsx(d.Option,{value:s.value,children:e.jsx(P,{bordered:!1,color:s.color,children:s.label})},`${R.generate()}`))}),country:e.jsx(d,{showSearch:!0,defaultValue:t.defaultValue,optionFilterProp:"children",filterOption:(s,h)=>((h==null?void 0:h.label)??"").toLowerCase().includes(s.toLowerCase()),filterSort:(s,h)=>((s==null?void 0:s.label)??"").toLowerCase().startsWith(((h==null?void 0:h.label)??"").toLowerCase()),style:{width:"100%"},children:le.map(s=>e.jsxs(d.Option,{value:s.value,label:c(s.label),children:[(s==null?void 0:s.icon)&&(s==null?void 0:s.icon)+" ",c(s.label)]},s.value))}),search:e.jsx(fe,{entity:t.entity,displayLabels:t.displayLabels,searchFields:t.searchFields,outputValue:t.outputValue}),selectWithFeedback:e.jsx(d,{onChange:s=>u(s),defaultValue:t.defaultValue,style:{width:"100%"},children:(b=t.options)==null?void 0:b.map(s=>e.jsx(d.Option,{value:s.value,children:c(s.label)},`${R.generate()}`))}),selectWithTranslation:e.jsx(d,{children:(f=t==null?void 0:t.options)==null?void 0:f.map(s=>e.jsx(d.Option,{value:s.value,children:e.jsx(P,{bordered:!1,color:s.color,children:c(s.label)})},`${R.generate()}`))})},j={string:"string",textarea:"string",phone:"string",number:"number",url:"url",website:"url",email:"email"},m=r[t.type]??r.string;return e.jsx(me.Item,{label:t.label,name:t.name,rules:[{required:t.required||!1,type:j[t.type]??"any"}],valuePropName:t.type==="boolean"?"checked":"value",children:m})}export{we as C,Ee as D};
