import{aD as A,a as n,ao as e,aq as W,aT as z,aE as H}from"./index-PXb9zWLD.js";import{C as G,a as X,D as Y,b as Z,S as J,u as K,s as Q,d as ee,R as te,U as se,e as ae,f as re,T as V,g as R,c as ne,h as ce,i as le}from"./useOnFetch-FPN0ClPk.js";import{V as U,W as T,H as q,G as P,X as oe,Y as d,Z as ue,_ as D,$ as ie,a0 as de,a1 as he}from"./MernOs-qaQ5bbZr.js";import{c as _}from"./action-XTLgilpi.js";import{r as B}from"./ErpApp-cqodzhCS.js";import{I as $}from"./index-IFdvQPhR.js";import{S as me}from"./selector-kZgu6KfM.js";const xe=({config:t})=>e.jsx(U,{gutter:8,children:e.jsx(T,{className:"gutter-row",span:24,children:e.jsx(J,{config:t})})});function pe({config:t,formElements:u}){const c=q(),a=A(),{crudContextAction:r,state:j}=K(),{deleteModalLabels:m}=t,{editBox:x,modal:p}=r,{isReadBoxOpen:b,isEditBoxOpen:f}=j,{result:s}=W(Q),[h,y]=n.useState(""),v=()=>{a(_.currentAction({actionType:"update",data:s})),x.open()},S=()=>{a(_.currentAction({actionType:"delete",data:s})),p.open()},L=b||f?{opacity:1}:{opacity:0};return n.useEffect(()=>{if(s){const C=m.map(O=>s[O]).join(" ");y(C)}},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(U,{style:L,gutter:24,children:[e.jsx(T,{span:10,children:e.jsx("p",{style:{marginBottom:"10px"},children:h})}),e.jsxs(T,{span:14,children:[e.jsx(P,{onClick:S,type:"text",icon:e.jsx(ee,{}),size:"small",style:{float:"right",marginLeft:"0px",marginTop:"10px"},children:c("remove")}),e.jsx(P,{onClick:v,type:"text",icon:e.jsx(oe,{}),size:"small",style:{float:"right",marginRight:"5px",marginTop:"10px"},children:c("edit")})]}),e.jsx(T,{span:24,children:e.jsx("div",{className:"line"})}),e.jsx("div",{className:"space10"})]}),e.jsx(te,{config:t}),e.jsx(se,{config:t,formElements:u})]})}function ge({config:t,createForm:u,updateForm:c}){const a=A();return n.useLayoutEffect(()=>{a(_.resetState())},[]),e.jsxs(G,{config:t,headerPanel:e.jsx(xe,{config:t}),sidePanelTopContent:e.jsx(pe,{config:t,formElements:c}),sidePanelBottomContent:e.jsx(X,{config:t,formElements:u}),children:[e.jsx(Y,{config:t}),e.jsx(Z,{config:t})]})}function fe({entity:t,displayLabels:u,searchFields:c,outputValue:a="_id",value:r,onChange:j}){let{onFetch:m,result:x,isSuccess:p,isLoading:b}=ae();const[f,s]=n.useState([]),[h,y]=n.useState(void 0),v=n.useRef(!1),S=n.useRef(!1),[L,C]=n.useState(!1),[O,I]=n.useState(""),[w,o]=n.useState(""),[,i]=re(()=>{o(O)},z,[O]),g=async l=>await B.search({entity:t,options:l}),k=l=>u.map(E=>l[E]).join(" "),F=l=>{l&&l!=""&&(S.current=!0,C(!0),s([]),y(void 0),I(l))};return n.useEffect(()=>{if(w!=""){const E=g({q:w,fields:c});m(E)}return()=>{i()}},[w]),n.useEffect(()=>{S.current&&(p?s(x):(C(!1),y(void 0),s([])))},[p,x]),n.useEffect(()=>{r&&v.current&&(S.current?(y(r[a]||r),j(r[a]||r),v.current=!1):s([r]))},[r]),e.jsx(d,{loading:b,showSearch:!0,allowClear:!0,placeholder:"search",defaultActiveFirstOption:!1,filterOption:!1,notFoundContent:L?"... searching":e.jsx(ue,{}),value:h,onSearch:F,onChange:l=>{j&&l&&j(l[a]||l)},onClear:()=>{s([]),y(void 0),C(!1)},children:f.map(l=>e.jsx(d.Option,{value:l[a]||l,children:k(l)},l[a]||l))})}function je(t){const[u,c]=n.useState(null),[a,r]=n.useState(!0),[j,m]=n.useState(!1),[x,p]=n.useState(null);return n.useEffect(()=>{async function b(){try{const f=await t();c(f.result),m(!0)}catch(f){p(f)}finally{r(!1)}}b()},[a]),{data:u,isLoading:a,isSuccess:j,error:x}}function be(t){const{data:u,isLoading:c,isSuccess:a,error:r}=je(t);return{result:u,isLoading:c,isSuccess:a,error:r}}const ye=({entity:t,displayLabels:u=["name"],outputValue:c="_id",redirectLabel:a="",withRedirect:r=!1,urlRedirect:j="/",value:m,onChange:x})=>{var w;const[p,b]=n.useState([]),[f,s]=n.useState(void 0),h=H(),y=()=>B.list({entity:t}),{result:v,isLoading:S,isSuccess:L}=be(y),C=o=>{if(o==="redirectURL")h(j);else{const i=o[c]??o;s(o),x(i)}},O=o=>u.map(i=>o[i]).join(" "),I=()=>{const o=[];if(p.length===0&&r){const i="redirectURL",g=`+ ${a}`;o.push({value:i,label:g})}return p.map(i=>{var E;const g=i[c]??i,k=O(i),F=((E=i[c])==null?void 0:E.color)??(i==null?void 0:i.color),l=ne.find(M=>M.color===F);o.push({value:g,label:k,color:l==null?void 0:l.color})}),o};return n.useEffect(()=>{if(m){const o=m[c]??m;s(o),x(o)}},[m]),n.useEffect(()=>{L&&b(v)},[L]),e.jsx(d,{loading:S,disabled:S,value:f,onChange:C,children:(w=I())==null?void 0:w.map(o=>e.jsx(d.Option,{value:o.value,children:e.jsx(V,{bordered:!1,color:o.color,children:o.label})},`${R.generate()}`))})};function De({fields:t}){const[u,c]=n.useState();return e.jsx(e.Fragment,{children:Object.keys(t).map(a=>{let r=t[a];if(!r.disableForForm){if(r.name=a,r.label||(r.label=a),r.hasFeedback)return e.jsx(N,{setFeedback:c,field:r},a);if(u&&r.feedback){if(u==r.feedback)return e.jsx(N,{field:r},a)}else return e.jsx(N,{field:r},a)}})})}function N({field:t,setFeedback:u}){var x,p,b,f;const c=q(),a=ce(),r={string:e.jsx(D,{autoComplete:"off"}),url:e.jsx(D,{addonBefore:"https://",autoComplete:"off",placeholder:"www.sample.com"}),textarea:e.jsx(D.TextArea,{rows:4}),email:e.jsx(D,{autoComplete:"off",placeholder:"sample@gmail.com"}),phone:e.jsx(D,{style:{width:"100%"},placeholder:"+84 909 123 123"}),number:e.jsx($,{style:{width:"100%"}}),boolean:e.jsx(me,{checkedChildren:e.jsx(ie,{}),unCheckedChildren:e.jsx(de,{})}),async:e.jsx(ye,{entity:t.entity,displayLabels:t.displayLabels,outputValue:t.outputValue,loadDefault:t.loadDefault,withRedirect:t.withRedirect,urlRedirect:t.urlRedirect,redirectLabel:t.redirectLabel}),currency:e.jsx($,{className:"moneyInput",min:0,controls:!1,addonAfter:a.currency_position==="after"?a.currency_symbol:void 0,addonBefore:a.currency_position==="before"?a.currency_symbol:void 0}),select:e.jsx(d,{defaultValue:t.defaultValue,style:{width:"100%"},children:(x=t.options)==null?void 0:x.map(s=>e.jsx(d.Option,{value:s.value,children:s.label},`${R.generate()}`))}),color:e.jsx(d,{defaultValue:t.defaultValue,style:{width:"100%"},children:(p=t.options)==null?void 0:p.map(s=>e.jsx(d.Option,{value:s.value,children:e.jsx(V,{bordered:!1,color:s.color,children:s.label})},`${R.generate()}`))}),country:e.jsx(d,{showSearch:!0,defaultValue:t.defaultValue,optionFilterProp:"children",filterOption:(s,h)=>((h==null?void 0:h.label)??"").toLowerCase().includes(s.toLowerCase()),filterSort:(s,h)=>((s==null?void 0:s.label)??"").toLowerCase().startsWith(((h==null?void 0:h.label)??"").toLowerCase()),style:{width:"100%"},children:le.map(s=>e.jsxs(d.Option,{value:s.value,label:c(s.label),children:[(s==null?void 0:s.icon)&&(s==null?void 0:s.icon)+" ",c(s.label)]},s.value))}),search:e.jsx(fe,{entity:t.entity,displayLabels:t.displayLabels,searchFields:t.searchFields,outputValue:t.outputValue}),selectWithFeedback:e.jsx(d,{onChange:s=>u(s),defaultValue:t.defaultValue,style:{width:"100%"},children:(b=t.options)==null?void 0:b.map(s=>e.jsx(d.Option,{value:s.value,children:c(s.label)},`${R.generate()}`))}),selectWithTranslation:e.jsx(d,{children:(f=t==null?void 0:t.options)==null?void 0:f.map(s=>e.jsx(d.Option,{value:s.value,children:e.jsx(V,{bordered:!1,color:s.color,children:c(s.label)})},`${R.generate()}`))})},j={string:"string",textarea:"string",phone:"string",number:"number",url:"url",website:"url",email:"email"},m=r[t.type]??r.string;return e.jsx(he.Item,{label:t.label,name:t.name,rules:[{required:t.required||!1,type:j[t.type]??"any"}],valuePropName:t.type==="boolean"?"checked":"value",children:m})}export{ge as C,De as D};
